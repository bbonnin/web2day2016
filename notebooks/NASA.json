{"paragraphs":[{"text":"%spark\n\n\nimport com.mongodb.spark._\nimport com.mongodb.spark.config._\nimport com.mongodb.spark.rdd.MongoRDD\nimport org.bson.Document\n\nval readConf = ReadConfig( sc )\nval readConfig = ReadConfig( Map(\"collection\" -> \"eva\" ), Some(readConf))\nval evaRdd = sc.loadFromMongoDB( readConfig = readConfig )\n\n//println ( rdd.first() )\n//for( doc <- rdd.take( 10 ) ) println( doc )\n\ndef  breakoutCrew (  document: Document  ): List[(String,Int)]  = {\n\n  var minutes = 0;\n  val timeString = document.get( \"Duration\").asInstanceOf[String]\n  if( timeString != null && !timeString.isEmpty ) {\n    val time =  document.get( \"Duration\").asInstanceOf[String].split( \":\" )\n    minutes = time(0).toInt * 60 + time(1).toInt\n  }\n\n  import scala.util.matching.Regex\n  val pattern = new Regex(\"(\\\\w+\\\\s\\\\w+)\")\n  val names =  pattern findAllIn document.get( \"Crew\" ).asInstanceOf[String]\n  var tuples : List[(String,Int)] = List()\n  for ( name <- names ) { tuples = tuples :+ (( name, minutes ) ) }\n\n  return tuples\n}\n\nval logs = evaRdd.flatMap( breakoutCrew ).reduceByKey( (m1: Int, m2: Int) => ( m1 + m2 ) )\n\ndef mapToDocument( tuple: (String, Int )  ): Document = {\n  val doc = new Document();\n  doc.put(\"_id\", tuple._1)\n  doc.put( \"name\", tuple._1 )\n  doc.put( \"minutes\", tuple._2 )\n\n  return doc\n}\n\nval writeConf = WriteConfig(sc)\nval writeConfig = WriteConfig(Map(\"collection\" -> \"astronautTotals\", \"writeConcern.w\" -> \"majority\", \"db\" -> \"nasa\"), Some(writeConf))\n\nlogs.map( mapToDocument ).saveToMongoDB( writeConfig )\n\nprintln(\"%angular <br>Number of documents in EVA: <strong>\" + evaRdd.count() + \"</strong><br>\"\n + \"Number of documents in ASTRONAUTTOTALS: <strong>\" + logs.count() + \"</strong><br>\")\n\n/*\n\nsqlContext.sql(\"SELECT astronautTotals.name, astronautTotals.minutes, evas.Vehicle, evas.Duration FROM \" +\n  \"astronautTotals JOIN evas ON astronautTotals.name LIKE evas.Crew\"  ).show()\n*/\n\n","authenticationInfo":{},"dateUpdated":"May 22, 2016 4:10:20 PM","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1463916438572_-209747703","id":"20160522-132718_247268777","result":{"code":"SUCCESS","type":"ANGULAR","msg":"<br>Number of documents in EVA: <strong>375</strong><br>Number of documents in ASTRONAUTTOTALS: <strong>222</strong><br>\n"},"dateCreated":"May 22, 2016 1:27:18 PM","dateStarted":"May 22, 2016 4:08:27 PM","dateFinished":"May 22, 2016 4:08:35 PM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:186","focus":true},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1463917395874_-76271604","id":"20160522-134315_91000675","dateCreated":"May 22, 2016 1:43:15 PM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:187","dateUpdated":"May 22, 2016 4:09:07 PM","dateFinished":"May 22, 2016 4:09:12 PM","dateStarted":"May 22, 2016 4:09:07 PM","result":{"code":"SUCCESS","type":"TEXT","msg":"import org.apache.spark.sql.SQLContext\nimport com.mongodb.spark.sql._\nevadf: org.apache.spark.sql.DataFrame = [Country: string, Crew: string, Date: string, Duration: string, EVA #: conflict, Purpose: string, Vehicle: string, _id: struct<oid:string>]\nroot\n |-- Country: string (nullable = true)\n |-- Crew: string (nullable = true)\n |-- Date: string (nullable = true)\n |-- Duration: string (nullable = true)\n |-- EVA #: conflict (nullable = true)\n |-- Purpose: string (nullable = true)\n |-- Vehicle: string (nullable = true)\n |-- _id: struct (nullable = true)\n |    |-- oid: string (nullable = true)\n\ndefined class astronautTotal\nastronautDF: org.apache.spark.sql.DataFrame = [name: string, minutes: int]\nroot\n |-- name: string (nullable = true)\n |-- minutes: integer (nullable = true)\n\n"},"text":"%spark\n\nimport org.apache.spark.sql.SQLContext\nimport com.mongodb.spark.sql._\n\n// load the first dataframe \"EVAs\"\nval evadf = sqlContext.read.mongo()\nevadf.printSchema()\nevadf.registerTempTable(\"evas\")\n\n// load the 2nd dataframe \"astronautTotals\"\ncase class astronautTotal ( name: String, minutes: Integer )\nval astronautDF = sqlContext.read.option(\"collection\", \"astronautTotals\").mongo[astronautTotal]()\nastronautDF.printSchema()\nastronautDF.registerTempTable(\"astronautTotals\")\n\n","focus":true},{"config":{"colWidth":12,"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"keys":[{"name":"name","index":0,"aggr":"sum"}],"values":[{"name":"minutes","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"name","index":0,"aggr":"sum"},"yAxis":{"name":"minutes","index":1,"aggr":"sum"}}},"enabled":true,"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1463923730360_746777383","id":"20160522-152850_1253529495","dateCreated":"May 22, 2016 3:28:50 PM","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:371","dateUpdated":"May 22, 2016 4:09:45 PM","dateFinished":"May 22, 2016 4:09:45 PM","dateStarted":"May 22, 2016 4:09:45 PM","result":{"code":"SUCCESS","type":"TABLE","msg":"name\tminutes\nJohn Grunsfeld\t3510\nJerry Ross\t3501\nMike Lopez\t3344\nAnatoly Solovyev\t3086\nSunita Williams\t3040\nSteve Smith\t2988\nMike Fincke\t2916\nMike Fossum\t2912\nSteve Bowen\t2838\nScott Parazynski\t2825\n","comment":"","msgTable":[[{"key":"minutes","value":"John Grunsfeld"},{"key":"minutes","value":"3510"}],[{"value":"Jerry Ross"},{"value":"3501"}],[{"value":"Mike Lopez"},{"value":"3344"}],[{"value":"Anatoly Solovyev"},{"value":"3086"}],[{"value":"Sunita Williams"},{"value":"3040"}],[{"value":"Steve Smith"},{"value":"2988"}],[{"value":"Mike Fincke"},{"value":"2916"}],[{"value":"Mike Fossum"},{"value":"2912"}],[{"value":"Steve Bowen"},{"value":"2838"}],[{"value":"Scott Parazynski"},{"value":"2825"}]],"columnNames":[{"name":"name","index":0,"aggr":"sum"},{"name":"minutes","index":1,"aggr":"sum"}],"rows":[["John Grunsfeld","3510"],["Jerry Ross","3501"],["Mike Lopez","3344"],["Anatoly Solovyev","3086"],["Sunita Williams","3040"],["Steve Smith","2988"],["Mike Fincke","2916"],["Mike Fossum","2912"],["Steve Bowen","2838"],["Scott Parazynski","2825"]]},"text":"%sql\n\nSELECT astronautTotals.name, astronautTotals.minutes FROM astronautTotals ORDER BY astronautTotals.minutes DESC LIMIT 10\n\n"},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[{"name":"name","index":0,"aggr":"sum"}],"values":[{"name":"minutes","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"name","index":0,"aggr":"sum"},"yAxis":{"name":"minutes","index":1,"aggr":"sum"}}},"enabled":true,"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1463925085125_790533133","id":"20160522-155125_1072277801","dateCreated":"May 22, 2016 3:51:25 PM","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:620","dateUpdated":"May 22, 2016 4:10:52 PM","dateFinished":"May 22, 2016 4:10:57 PM","dateStarted":"May 22, 2016 4:10:52 PM","result":{"code":"SUCCESS","type":"TABLE","msg":"name\tminutes\tVehicle\tDuration\nAl Worden\t39\tApollo 15\t0:39\nAlexei Leonov\t12\tVoskhod 2\t0:12\nBuzz Aldrin\t487\tGemini XII\t2:29\nBuzz Aldrin\t487\tGemini XII\t2:06\nBuzz Aldrin\t487\tGemini XII\t0:55\nDavid Scott\t1200\tGemini VIII\t0:00\nDavid Scott\t1200\tApollo 9\t0:47\nDavid Scott\t1200\tApollo 15\t0:33\nEd White\t36\tGemini IV\t0:36\nEugene Cernan\t1460\tGemini IX-A\t2:07\nMike Collins\t89\tGemini X\t0:50\nMike Collins\t89\tGemini X\t0:39\nRichard Gordon\t174\tGemini XI\t0:44\nRichard Gordon\t174\tGemini XI\t2:10\nRon Evans\t67\tApollo 17\t1:07\nRuss Schweickart\t51\tApollo 9\t0:51\nTom Mattingly\t83\tApollo 16\t1:23\n","comment":"","msgTable":[[{"key":"minutes","value":"Al Worden"},{"key":"minutes","value":"39"},{"key":"minutes","value":"Apollo 15"},{"key":"minutes","value":"0:39"}],[{"key":"Vehicle","value":"Alexei Leonov"},{"key":"Vehicle","value":"12"},{"key":"Vehicle","value":"Voskhod 2"},{"key":"Vehicle","value":"0:12"}],[{"key":"Duration","value":"Buzz Aldrin"},{"key":"Duration","value":"487"},{"key":"Duration","value":"Gemini XII"},{"key":"Duration","value":"2:29"}],[{"value":"Buzz Aldrin"},{"value":"487"},{"value":"Gemini XII"},{"value":"2:06"}],[{"value":"Buzz Aldrin"},{"value":"487"},{"value":"Gemini XII"},{"value":"0:55"}],[{"value":"David Scott"},{"value":"1200"},{"value":"Gemini VIII"},{"value":"0:00"}],[{"value":"David Scott"},{"value":"1200"},{"value":"Apollo 9"},{"value":"0:47"}],[{"value":"David Scott"},{"value":"1200"},{"value":"Apollo 15"},{"value":"0:33"}],[{"value":"Ed White"},{"value":"36"},{"value":"Gemini IV"},{"value":"0:36"}],[{"value":"Eugene Cernan"},{"value":"1460"},{"value":"Gemini IX-A"},{"value":"2:07"}],[{"value":"Mike Collins"},{"value":"89"},{"value":"Gemini X"},{"value":"0:50"}],[{"value":"Mike Collins"},{"value":"89"},{"value":"Gemini X"},{"value":"0:39"}],[{"value":"Richard Gordon"},{"value":"174"},{"value":"Gemini XI"},{"value":"0:44"}],[{"value":"Richard Gordon"},{"value":"174"},{"value":"Gemini XI"},{"value":"2:10"}],[{"value":"Ron Evans"},{"value":"67"},{"value":"Apollo 17"},{"value":"1:07"}],[{"value":"Russ Schweickart"},{"value":"51"},{"value":"Apollo 9"},{"value":"0:51"}],[{"value":"Tom Mattingly"},{"value":"83"},{"value":"Apollo 16"},{"value":"1:23"}]],"columnNames":[{"name":"name","index":0,"aggr":"sum"},{"name":"minutes","index":1,"aggr":"sum"},{"name":"Vehicle","index":2,"aggr":"sum"},{"name":"Duration","index":3,"aggr":"sum"}],"rows":[["Al Worden","39","Apollo 15","0:39"],["Alexei Leonov","12","Voskhod 2","0:12"],["Buzz Aldrin","487","Gemini XII","2:29"],["Buzz Aldrin","487","Gemini XII","2:06"],["Buzz Aldrin","487","Gemini XII","0:55"],["David Scott","1200","Gemini VIII","0:00"],["David Scott","1200","Apollo 9","0:47"],["David Scott","1200","Apollo 15","0:33"],["Ed White","36","Gemini IV","0:36"],["Eugene Cernan","1460","Gemini IX-A","2:07"],["Mike Collins","89","Gemini X","0:50"],["Mike Collins","89","Gemini X","0:39"],["Richard Gordon","174","Gemini XI","0:44"],["Richard Gordon","174","Gemini XI","2:10"],["Ron Evans","67","Apollo 17","1:07"],["Russ Schweickart","51","Apollo 9","0:51"],["Tom Mattingly","83","Apollo 16","1:23"]]},"text":"%sql\n\nSELECT astronautTotals.name, astronautTotals.minutes, evas.Vehicle, evas.Duration\nFROM astronautTotals\nJOIN evas ON astronautTotals.name LIKE evas.Crew\n\n"},{"config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1463926252562_-1374375072","id":"20160522-161052_297039740","dateCreated":"May 22, 2016 4:10:52 PM","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:790"}],"name":"NASA","id":"2BMP7GXJK","angularObjects":{"2BFVZKH43":[],"2BKPRWNPH":[],"2BG7WNHWR":[],"2BHKGDHRF":[],"2BKG2YTA6":[],"2BGWYDRXY":[],"2BJKM5UJQ":[],"2BHS5GZNT":[],"2BGEPGCQ9":[],"2BJKHMRRZ":[],"2BJTZG6XT":[],"2BJF97VHW":[],"2BHGXZFCS":[],"2BH8JCPSU":[],"2BGTDRTZE":[],"2BKBEZNQA":[],"2BHSF1F9B":[],"2BKSW157N":[]},"config":{"looknfeel":"default"},"info":{}}